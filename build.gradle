plugins {
    id 'org.springframework.boot' version "${springBootVersion}" apply false
    id 'io.spring.dependency-management' version '1.0.11.RELEASE' apply false
    id "io.github.lognet.grpc-spring-boot" version '4.7.0' apply false
}

allprojects {
    group = "io.github"

    repositories {
        mavenLocal()
        maven { url "https://maven.aliyun.com/repository/public" }
        mavenCentral()
        maven { url "https://artifacts.alfresco.com/nexus/content/repositories/activiti-releases" }
    }

    configurations.all {
        resolutionStrategy.cacheChangingModulesFor 0, "minutes"
        resolutionStrategy.cacheDynamicVersionsFor 0, "seconds"
    }
}

subprojects {

    apply from: "$rootDir/src/publications.gradle"

    plugins.withType(JavaPlugin) {

        sourceCompatibility = JavaVersion.VERSION_11
        targetCompatibility = JavaVersion.VERSION_11

        java {
            withSourcesJar()
        }

        publishing {
            publications {
                mavenJava(MavenPublication) {
                    version "$version"
                    from components.java
                    versionMapping {
                        usage('java-api') {
                            fromResolutionOf('runtimeClasspath')
                        }
                        usage('java-runtime') {
                            fromResolutionResult()
                        }
                    }
                }
            }
        }

        configurations {
            compileOnly {
                extendsFrom annotationProcessor
            }
        }

        test {
            useJUnitPlatform()
        }

    }

}